name: AWS SSM and S3 Operations

on:
  workflow_dispatch:
    inputs:
      actionType:
        description: 'Select Action (Backup or Restore)'
        required: true
        type: choice
        options:
        - Backup
        - Restore
      bucketName:
        description: 'S3 Bucket Name (required for Restore)'
        required: false

jobs:
  process:
    runs-on: POC
    steps:
    - name: Checkout repository
      uses: actions/checkout@v2

    - name: Set up AWS CLI
      uses: aws-actions/configure-aws-credentials@v1
      with:
        role-to-assume: ${{ secrets.AWS_ROLE_TO_ASSUME }}
        aws-region: us-east-1

    - name: List SSM Parameters (for Backup)
      if: ${{ github.event.inputs.actionType == 'Backup' }}
      run: |
        echo "Listing SSM Parameters..."
        aws ssm describe-parameters --output table

    - name: List S3 Objects (for Restore)
      if: ${{ github.event.inputs.actionType == 'Restore' }}
      run: |
        echo "Listing S3 Objects in bucket: ${{ github.event.inputs.bucketName }}"
        aws s3 ls s3://${{ github.event.inputs.bucketName }} --output table
